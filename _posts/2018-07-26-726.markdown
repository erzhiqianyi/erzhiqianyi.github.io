---
layout: post
title: 2018-07-26
date: 2018-07-26 21:11:11 +0800
categories:  生活
---

2018年7月26日，星期四，晴。

今天比平常早期10分钟，7点10分左右起的。其实平常差不多这个点也会醒，但是会在眯几分钟，等到7点25分的闹钟叫才起，有时还会小睡一会，就是7点34再起，小睡一会一般是天气比较好的时候，可以踩板到地铁站，再从地铁站踩板到公司。今天早上天气不是很好，能听到淅淅沥沥的雨声，所以早期了10分钟。不过到地铁站的时候还是7点40多了。人并不多，没有去黄村，直接在车陂上的地铁，比较靠近门。还以为比较早，人不会太多，没想到进地铁之后，稍微停顿了一下，忽然被人推了一把，好可怕，差点就摔倒了。

今天下班比较迟，7点才下班，有没有带板，从公司走到地铁站，20多分钟，回来快8点了。这几天晚餐都是点外卖，点的还是同一家，味道还可以，速度也快，有3个特价菜，才1块钱一份。之前去他们店里吃过,味道可以，店面也也大，比较放心。

## 昨日梦

昨天的梦不多，有一个场景好像是在讨论技术问题，好像还讨论了很久。

## 今日电影

最近3天，趁着吃晚饭的时间，看了印度电影《厕所英雄》。确实不错，可以看看。所谓“文化”，真的是文化吗？真的要坚持吗？不是所有经过里历史的长河的东西就是好东西。一粒老鼠屎，坏了一锅粥。老鼠屎就是老鼠屎，该清理就清理。

## 今日阅读

今天刷了一路的微博和Twitterz。好像有不少人在声援“me too"运动，一夜之间，不少人出来说谁谁流氓,稍微扫了一下，没有细看。她们能够站出来说，确实不容易。那些伪善之人，就应该阉割掉。这样的事情，以前不是没有，现在也不是没有在进行，将来也不会停止。总需要有人站出来，如果没有人要改变，那么什么都不会改变。需要增大这类犯罪的成本。更可悲的是有人并不觉得这是犯罪，还认为是成功的象征，到处吹嘘，而听着，并不觉这是问题。

## 今日技术

Emoji处理

事情源于一个微信绑定。其实上一个项目，也出项过emoji的情况。之前直接使用微信登陆，用户信息，也直接使用微信用户信息，包括用户昵称。在项目设计的时候，并没有考虑emoji。数据库用的是mysql ,相应字段是utf8。刚开始并没有什么问题，后来有个用户，总是无法登陆。看日志，才发现是在保存用户信息的时候报错了，用户昵称无法保存，数据格式不对。经过google ,才发现是数据库字符集的问题。当初有两个解决方案，一个是改数据库的字符集，另外一个是在保存用户昵称的时候使用base64编码，取出来的时候再解码。考虑到当初用户数据并不是很多，采取了改数据库字符集，没想到这是hardway,搞了一天才搞掂。

今天遇到这个问题，也是绑定用户信息，需要把微信昵称保存到系统中。无法绑定这个问题上个星期就提出来了，当初以为是缓存的问题，因为日志并没有走到保存到数据库那一步，前面的步骤就停了。也没有报错，而其他好几个用户和手机都能过绑定。今天让无法绑定的用户清理微信缓存，还是无法绑定，也没有走到保存用户信息那一步。

最后发现用户的微信昵称中有Emoji。而我们测试的几个账号，都没有Emoji。把用户的昵称直接复制过来，在本地跑测试，竟然发现无法json库无法解析微信返回的数据，在解析的时候报错了，而在正式环境并没有任何报错。经过排查，确定问题是由Emoji引发的。至于那段解析微信返回的信息的代码，就不多说了。明明一行代码就可以完成解析，那段代码竟然有了好几行，操作也比较诡异，先转成JsonArray ,再将JsonArray转成Bean ,可能是比较古老的代码，但是能古老到哪里去？微信提供这个也没有纪念啊！

最后的解决方案是在保存昵称前，先进行base64编码，没有去改数据库字符集。改起来比较麻烦，版本都没有满足。

## 今日份新闻

github今日移除了jquery ,使用原生js。登陆github,发现提供了一个beta版的dashboard,好像还可以。之前的项目是用angluar js写的，不过写得比较糟糕。现在，没有框架，也要写写前端。第一次接触项目，就被震惊了。前端文件管理比较混乱，各种各样版本的jquery混杂，所有js包和css包都在自己服务器保存了一份，保存在项目的目录下，项目使用tomcat跑的，所以这些静态资源文件也是由tomcat来处理。所以还是要多学下Js。
