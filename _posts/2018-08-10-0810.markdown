---
layout: post
title: 2018-08-10
date: 2018-08-10 20:53:11 +0800
categories:  生活
---

2018年8月10日，星期五，有雨。

今天比平常醒的略早，因为阳光从门缝里照进来了。以前在学校的时候，没有挂窗帘，一大早，太阳久会照进来，一见到光就会醒,当然这限于夏天，冬天就睡大觉了。来了广州，第一个住的地方虽然是顶楼，但光线并不好，窗子也很小,再加上窗帘，几乎没什么光。现在这里还好，卧室阳光还是很充足，今天之所以有阳光进来，是昨天晚上门没有关好,怪不得一晚上都觉得有点热，空调也抵挡不住这么大一条缝。

一星期又过去了，这个星期都没有做什么。可能是因为上个周末回去了，稍微有点折腾，这一个星期状态都不是很好，中午吃完饭后就比较困，一躺下就能睡着，以前都要到12点50左右才能睡着,这几天12:30就睡着了，也能睡到1点半，只能睡到1点半，因为1点半就要工作了。晚上回来状态也不是很好,自己下了两次面条，去外面吃了三次。

今天下的面条还可以，鸡蛋，瘦肉，蘑菇，西红柿,葱，面条，前面5样食材加起来一共10.8元，煮了一锅汤，比较鲜，大概是蘑菇的缘故，至于番茄，可能是只有一个，汤又比较多，几乎没有什么番茄的味道，又或者是番茄的加入提升了蘑菇的鲜。剩下的面条好像还以吃个4顿左右。

工作上，这个星期只做了一个需求。本来已经可以发布，但是今天看到之前的代码，实在是糟糕，本来打算以后再改，但是这几天已经改了这里，在原有的基础上继续怼逻辑，能跑起来，只是改起来比较麻烦。一大段面条式代码，不喜欢这样，于是决定重构下，免得下次改这里还要继续这个痛苦的过程。这个地方已经确定下次还要改，可能还不只改一次，所以趁现在还不是太烂的时候优化下。

最近在看spring boot ,打算用spring boot写一个博客。现在用的博客是github的静态博客，很方便，只要写markdown文档就好了。作为一个程序员，总得有点自己的项目吧！现在没有参与开源项目，那就先自己捣鼓下。spring boot 还是spring,只是简化了很多配置，减少配置，让程序员更专注元业务逻辑开发。而我最近的操作，感觉有点舍本逐末，纠结于各种配置。当然配置很重要，因为不配置好，就跑都跑不起来。现在还没有想好博客怎么设计。大概想法是前后端分离，服务端只提供数据接口，前端负责渲染,博客内容使用mardkown编写，前端渲染markdown ,还要支持图片分享，像微博那样，不过初期只有一个账号能发布内容。

## 今日bug
最近群里在讨论服务端性能优化，服务端监控。发现这些和我现在项目离得很远，几乎没有用到。比如服务端参数调优，性能监控，这些都没有。现在的性能问题，基本上不涉及到系统级别，而是代码问题。之前写的代码，怎么说呢？看着就想改，一个方法动不动就几百行，上千行的也不少见。代码多也就算了，还是面条式代码，if else if else  相当多，一个嵌套好几个，五六个很常见。每次看代码，都要找很久。实在是不太想看。在循环中执行sql操作也是很常见，极端情况下，一个循环执行5000次sql查询（为什么会有5000次，因为用户上传的数据就这么多，也没限制），一次操作执行个20多分钟也不是没有。当然用户不会等到20多分钟，因为5分钟就断开了，就提示操作失败了。仅仅这一个操作优化，就将处理时间缩小到不到1分钟，同样是5000条数据。这样的操作还有不少，仍然需要优化。估计要等这些地方优化好后，才会用到系统级别的调优。

不过今天却遇到了系统级别的问题。早上按往常一样，计划今天的任务，分解成番茄时间，打开番茄，开始工作。一个番茄过后，忽然收到一条错误邮件提醒，然后不停的收到邮件提醒。是数据库错误，错误代码1030， Got error 28 from storage engine。以前没遇到过啊！上google一搜，sstackoverflow 已经有人提过类似的问题，这个代码说明磁盘没有足够的空间了。再看执行的sql语句，是一个存储过程，创建了好几张临时表，问题就在这里了。查看磁盘使用率，果然有点紧张。其他地方不能删，只能删日志，看了下日志，好像从系统运行到现在都没有处理过，一个日志文件达到了20多个G，只能动这个文件了，这个文件把debut级别的日志都打印出来了，主要是sql语句。清理下这个日志文件，果然没问题了。当然期间还收到用户反馈，无法登陆。当然无法登录，因为这个错误就是登录的时候发生的。

看了下这个存储过程，很惭愧，这么长的sql语句，不想看。从名字看出这个存储过程的作用，还好这个命名还是对的。我不喜欢用存储过程，也反对使用存储过程，也不怎么会写。系统现在还有几个存储过程，而且都是在登录的时候要用到。今天触发问题的这个存储过程我已经在程序里实现了相应的逻辑，查询一次，也不用临时表。但是个修改是在另外一个分支，而且这个分支已经很久没有开发，没有合并到主干，也没有发布。为什么没合并？改的东西太多，还没改完，还没测试，就中断了开发。争取早日把这几存储过程都替换掉，以及视图。

看来有必要加上服务器性能监控和异常预警。现在只有在发生异常时才会发送邮件预警，这个功能还是后面才加上的。

## 今日阅读
码农翻身推荐的[什么样的 GitHub 才适合放简历上？](https://mp.weixin.qq.com/s/Sknn00RwIkEynjRgNKDv_Q)。
如果是程序员，看到这里还不知道GitHub是什么，可以撤了。这本博客目前就是在GitHub上托管的。
大概是15年的时候开始接触github,之前建了好几个账号，都删了。直到前年，才决定用现在这个账号。一直没有什么项目。把之前写的安卓项目放上去了，后来觉得不怎么样，就删掉了。现在只有这个博客，其他几个项目是fork过来的。对比这篇文章，还好没有什么减分项，主要的提交记录都是这个博客贡献的。之前写安卓时关注了一大推项目，现在关注的还是这些。乱命名倒是没有，都没有项目，就没有命名的问题了。至于提交，都是晚上写完再提交。现在的状态是回来不碰工作项目（也没有办法碰，电脑关机），工作专注于工作。

现在坚持提交的就是这个博客了。当然这个博客的提交说明也比较简单，只有日期，好像也不需要更多说明。坚持每天提交一次，荒漠变绿地，绿水千山就是金山银山。









